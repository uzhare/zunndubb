import requests
from pprint import pprint as pp
from urlparse import urlparse
from PIL import Image
from StringIO import StringIO



imdb250all = ['tt0111161', 'tt0068646', 'tt0071562', 'tt0110912', 'tt0060196', 'tt0050083', 'tt0468569', 'tt0108052', 'tt0167260', 'tt0137523', 'tt0080684', 'tt0073486', 'tt0120737', 'tt1375666', 'tt0099685', 'tt0076759', 'tt0047478', 'tt0133093', 'tt0109830', 'tt0167261', 'tt0317248', 'tt0064116', 'tt0114369', 'tt0102926', 'tt0034583', 'tt0114814', 'tt0082971', 'tt0047396', 'tt0054215', 'tt0038650', 'tt0110413', 'tt0043014', 'tt0209144', 'tt0120586', 'tt0078788', 'tt0103064', 'tt0057012', 'tt0120815', 'tt0078748', 'tt0021749', 'tt0053125', 'tt1345836', 'tt1853728', 'tt0245429', 'tt0027977', 'tt0033467', 'tt0081505', 'tt0088763', 'tt0253474', 'tt0052357', 'tt0407887', 'tt0022100', 'tt0169547', 'tt0075314', 'tt0050825', 'tt0118799', 'tt0435761', 'tt0036775', 'tt0090605', 'tt0910970', 'tt0405094', 'tt0066921', 'tt1675434', 'tt0172495', 'tt0120689', 'tt0211915', 'tt0056172', 'tt0032553', 'tt0482571', 'tt0056592', 'tt0105236', 'tt0082096', 'tt0180093', 'tt0041959', 'tt0040897', 'tt0338013', 'tt0095765', 'tt0087843', 'tt0110357', 'tt0071315', 'tt0086190', 'tt0119488', 'tt0093058', 'tt0112573', 'tt0071853', 'tt0364569', 'tt0045152', 'tt0053291', 'tt0086879', 'tt0017136', 'tt0042876', 'tt0040522', 'tt0062622', 'tt0105695', 'tt0042192', 'tt0053604', 'tt0097576', 'tt0070735', 'tt0081398', 'tt0050212', 'tt0051201', 'tt0095016', 'tt0372784', 'tt1832382', 'tt0095327', 'tt0457430', 'tt0363163', 'tt0055630', 'tt0031679', 'tt0059578', 'tt0208092', 'tt0057115', 'tt0361748', 'tt1049413', 'tt0047296', 'tt0080678', 'tt0114709', 'tt0050976', 'tt0113277', 'tt0017925', 'tt0033870', 'tt0083658', 'tt0032976', 'tt1205489', 'tt0050986', 'tt0116282', 'tt0012349', 'tt0086250', 'tt0118715', 'tt0052311', 'tt0089881', 'tt0848228', 'tt0077416', 'tt0061512', 'tt0015864', 'tt0903624', 'tt0401792', 'tt0044079', 'tt0025316', 'tt0477348', 'tt0120735', 'tt0073195', 'tt0167404', 'tt0091763', 'tt0084787', 'tt0044706', 'tt0395169', 'tt0064115', 'tt0112641', 'tt0032138', 'tt0117951', 'tt0266697', 'tt1291584', 'tt0075686', 'tt1305806', 'tt0119217', 'tt0038787', 'tt0031381', 'tt0032551', 'tt1504320', 'tt0758758', 'tt0079470', 'tt0096283', 'tt0434409', 'tt0266543', 'tt0892769', 'tt0046912', 'tt0038355', 'tt0088247', 'tt0074958', 'tt0052618', 'tt0405159', 'tt0469494', 'tt0048424', 'tt0092005', 'tt0246578', 'tt0947798', 'tt0107048', 'tt0454876', 'tt0072890', 'tt0114746', 'tt0245712', 'tt0440963', 'tt0978762', 'tt0053198', 'tt0060827', 'tt0083987', 'tt0061722', 'tt0049406', 'tt0347149', 'tt0093779', 'tt0056801', 'tt1010048', 'tt1655442', 'tt0268978', 'tt0054997', 'tt0061184', 'tt0047528', 'tt0056218', 'tt0075148', 'tt0065214', 'tt0052561', 'tt0070047', 'tt0046359', 'tt1024648', 'tt0040746', 'tt0069281', 'tt0056217', 'tt0072684', 'tt1659337', 'tt0353969', 'tt1136608', 'tt0338564', 'tt0079944', 'tt0046250', 'tt0120382', 'tt0325980', 'tt1220719', 'tt1045658', 'tt0401383', 'tt0107207', 'tt0382932', 'tt1201607', 'tt0198781', 'tt0058461', 'tt0044081', 'tt0796366', 'tt0101414', 'tt0063522', 'tt0042546', 'tt0087544', 'tt1255953', 'tt0113247', 'tt0020629', 'tt0095953', 'tt1130884', 'tt1125849', 'tt0374546', 'tt0013442', 'tt0327056', 'tt0079522', 'tt1187043', 'tt0070511', 'tt0107290', 'tt0319061', 'tt0015648', 'tt0092067', 'tt0094226', 'tt0036342', 'tt0029947']
imdb250 = ['tt0012349', 'tt0086250', 'tt0118715', 'tt0052311', 'tt0089881', 'tt0848228', 'tt0077416', 'tt0061512', 'tt0015864', 'tt0903624', 'tt0401792', 'tt0044079', 'tt0025316', 'tt0477348', 'tt0120735', 'tt0073195', 'tt0167404', 'tt0091763', 'tt0084787', 'tt0044706', 'tt0395169', 'tt0064115', 'tt0112641', 'tt0032138', 'tt0117951', 'tt0266697', 'tt1291584', 'tt0075686', 'tt1305806', 'tt0119217', 'tt0038787', 'tt0031381', 'tt0032551', 'tt1504320', 'tt0758758', 'tt0079470', 'tt0096283', 'tt0434409', 'tt0266543', 'tt0892769', 'tt0046912', 'tt0038355', 'tt0088247', 'tt0074958', 'tt0052618', 'tt0405159', 'tt0469494', 'tt0048424', 'tt0092005', 'tt0246578', 'tt0947798', 'tt0107048', 'tt0454876', 'tt0072890', 'tt0114746', 'tt0245712', 'tt0440963', 'tt0978762', 'tt0053198', 'tt0060827', 'tt0083987', 'tt0061722', 'tt0049406', 'tt0347149', 'tt0093779', 'tt0056801', 'tt1010048', 'tt1655442', 'tt0268978', 'tt0054997', 'tt0061184', 'tt0047528', 'tt0056218', 'tt0075148', 'tt0065214', 'tt0052561', 'tt0070047', 'tt0046359', 'tt1024648', 'tt0040746', 'tt0069281', 'tt0056217', 'tt0072684', 'tt1659337', 'tt0353969', 'tt1136608', 'tt0338564', 'tt0079944', 'tt0046250', 'tt0120382', 'tt0325980', 'tt1220719', 'tt1045658', 'tt0401383', 'tt0107207', 'tt0382932', 'tt1201607', 'tt0198781', 'tt0058461', 'tt0044081', 'tt0796366', 'tt0101414', 'tt0063522', 'tt0042546', 'tt0087544', 'tt1255953', 'tt0113247', 'tt0020629', 'tt0095953', 'tt1130884', 'tt1125849', 'tt0374546', 'tt0013442', 'tt0327056', 'tt0079522', 'tt1187043', 'tt0070511', 'tt0107290', 'tt0319061', 'tt0015648', 'tt0092067', 'tt0094226', 'tt0036342', 'tt0029947']

def imdbid(url):
    urlparts = urlparse(url).path.split('/')
    urlparts.reverse()
    for part in urlparts:
        if part.startswith('tt'):
            return part

imdbapi = 'http://imdbapi.org/?id=%s&plot=full&episode=1&lang=en-us'

for id in imdb250:
    print
    print '='*80
    r = requests.get(imdbapi % id)
    infofile = open('tmp/%s.json' % id, 'w')
    posterfile = 'tmp/%s.jpg' % id
    if r.status_code == 200:
        print "    Title: %s" % r.json.get('title', 'No Title')
        infofile.writelines(r.text)
        infofile.close()
        print "    JSON file written"
        poster_url = r.json.get('poster', None)
        print "    Poster URL: %s" % poster_url
        print "    Downloading the poster... ",
        poster = requests.get(poster_url)
        image = Image.open(StringIO(poster.content))
        image.save(posterfile)
        print "[DONE]"


